<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<style type="text/css">	
	/* body style for the video fullpage mode - hardcoded for now */
	body {	height	: 100%;
		width	: 100%;
		margin	: 0px;
		scroll	: "no";
		overflow: hidden;
		background-color: transparent;
	}
</style>
<script src="http://jmehost1/~jerome/neoip_html/base/firebug/firebug.js"></script> 
<script src="http://jmehost1/~jerome/neoip_html/base/javascript/swfobject.js"></script> 
</head>
<body onload="onload_cb()">

<div id="neoip_player_container_id">Place to put player container</div>

<script>
	function thisMovie(movieName){
		var isIE	= navigator.appName.indexOf("Microsoft") != -1;
		return (isIE) ? window[movieName] : document[movieName];
	}
	function dump_info(){
		var player	= thisMovie("plugin_html_id");
		console.info("current_time=" + player.current_time());
	}
	function playing_start(){
		var player	= thisMovie("plugin_html_id");
		player.playlist_loop(false);
		player.playing_start();
	}
	function playing_stop(){
		var player	= thisMovie("plugin_html_id");
		player.playing_stop();		
	}
	function neoip_flash_player_cb(cb_key, event_type, arg){
		// log to debug
		//console.info("cb_key=" + cb_key + " event_type=" + event_type + " arg=%o", arg);
		// handle the event by event_type
		if( event_type == "current_time" ){
			console.info("The playhead is currently at " + arg.time + "-sec");
		}else if( event_type == "state_change" ){
			console.info("player state went from " + arg.old_state + " to " + arg.new_state);
		}else if( event_type == "flv_kframe_find_cb" ){
			event_type	= arg.event_type;
			arg		= arg.arg;			
			console.info("flv_kframe_find_cb event_type="+ event_type + " arg=" + arg);
			for(var key in arg)	console.info("arg: " + key + " = " + arg[key]);
		}else if( event_type == "embedui_event" ){
			return embedui_event_cb(arg['event_type'], arg['arg']);
		}else{
			console.info("unparsed event_type="+ event_type + " arg=" + arg);
			for(var key in arg)	console.info("arg: " + key + " = " + arg[key]);
		}
	}
	function embedui_event_cb(event_type, arg){
		var userptr	= arg['userptr'];
		var embedui_id	= userptr['embedui_id'];
		console.info("embedui_id=" + embedui_id);
		console.dir(arg);
		if( embedui_id == "button_vol_id" )	return embedui_button_vol_cb(event_type, arg);
		if( embedui_id == "button_winsizer" )	return embedui_button_winsizer_cb(event_type, arg);
	}
	function embedui_button_vol_cb(event_type, arg){
		var plugin	= thisMovie("plugin_html_id");
		console.info("enter");
		console.dir(arg);
		// if event_type == "click", toggle the mute status
		if( event_type == "click" ){
			// toggle the mute in the plugin
			plugin.set_sound_mute( !plugin.get_sound_mute() );
			// change the ui_element
			plugin.embedui_update("button_vol_id", { "action": "element_update_opt",
					"arg":	{ "sound_mute" : plugin.get_sound_mute() } });
		}
		// if event_type == "mouseWheel", inc/dec the sound_vol
		if( event_type == "mouseWheel" ){
			var delta	= arg['wheel_delta'] * 0.1;
			var new_vol	= plugin.get_sound_vol() + delta;
			// clamp new_vol between 0 and 1
			new_vol		= Math.max(new_vol, 0);
			new_vol		= Math.min(new_vol, 1);
			// set the new_vol in the plugin
			plugin.set_sound_vol( new_vol );
			// change the ui_element
			plugin.embedui_update("button_vol_id", { "action": "element_update_opt",
						"arg":	{ "sound_vol" : plugin.get_sound_vol() } });			
		}
	}
	function embedui_button_winsizer_cb(event_type, arg){
		var plugin		= thisMovie("plugin_html_id");
		var may_fullscreen	= plugin.may_fullscreen();


		if( event_type == "click" && may_fullscreen ){
			// toggle the hw-fullscreen in the plugin
			plugin.set_fullscreen( !plugin.get_fullscreen() );
		}else if( event_type == "mouseWheel" || event_type == "click" ){
			if( plugin.getAttribute("width") == "100%" ){
				plugin.setAttribute("width", "320");
				plugin.setAttribute("height", "240");
			}else{
				plugin.setAttribute("width", "100%");
				plugin.setAttribute("height", "100%");
			}
		}

		// make the embedui invisible
		plugin.embedui_update("button_winsizer", { "action": "base_reset_state",
					"arg":	{ "new_state": "invisible" } });


		// determine the image to display
		var is_fullscreen	= plugin.get_fullscreen();
		var is_maximized	= plugin.getAttribute("width") == "100%";
		var button_normalizer	= may_fullscreen ? is_fullscreen : is_maximized;
		// modify the ui
		plugin.embedui_update("button_winsizer", { "action": "element_update_opt",
					"arg":	{ "location" : button_normalizer 
							? "win_normalizer"
							: "win_maximizer"} });

	}

	function playlist_populate(){
		// dev_id for youtube bwo8aCyQwSE
		var player	= thisMovie("plugin_html_id");
		var track_arg;
if( 0 ){
		// put this track
		track_arg	= { content_url	: 'http://jmehost2/~jerome/output.flv?bla=bli&slota=sloti',
					};
		//player.track_add(track_arg, player.track_count());	
		// put this track
		track_arg	= { content_url	: 'http://cache.googlevideo.com/get_video?video_id=45WY57lS708',
				 //   start_time	: 10,
					};
		player.track_add(track_arg, player.track_count());
		// put this track
		track_arg	= {	content_url	: "http://74.125.13.21/get_video?video_id=7uYoodBeqDI"
					};
		player.track_add(track_arg, player.track_count());	
		// put this track
		track_arg	= { content_url	: "http://74.125.13.21/get_video?video_id=7uYoodBeqDI",
					start_time	: 26,
					rangereq_type 	: 'flv',
					rangereq_flv_var: 'start',
					};
}
if(1){
		//player.track_add(track_arg, player.track_count());
		// put this track
		track_arg	= {	content_url	: "http://jmehost2/~jerome/trailer2.mp4"
					};
		player.track_add(track_arg, player.track_count());
}
if(0){
		//player.track_add(track_arg, player.track_count());	
		// put this track
		track_arg	= {	content_url	: "http://localhost:4550/flv/http://jmehost2/~jerome/output.flv",
					flv_mdata_uri	: "http://jmehost1/~jerome/output.flv.flv_mdata.xml",
					flv_mdata_type	: "external",
					start_time	: 26,
					rangereq_type 	: 'flv',
					rangereq_flv_var: 'pos'
					};
		player.track_add(track_arg, player.track_count());
}
if(0){	
		// put this track
//		track_arg	= { content_url		: "http://blip.tv/file/get/BreakaLegTV-BreakALegEpisode2Part1174.flv"
//		track_arg	= { content_url		: 'http://jmehost2/~jerome/golfers.flv',
		track_arg	= { content_url		: 'http://jmehost2/~jerome/output.flv',
					};
		player.track_add(track_arg, player.track_count());
}
if(0){
		// put this track
		track_arg	= {	content_url	: 'http://localhost:4550/flv/http://jmehost2/~jerome/output.flv',
					start_time	: 26,
					rangereq_type 	: 'flv',
					rangereq_flv_var: 'pos'
					};
		player.track_add(track_arg, player.track_count());
}
if(0){
		// TODO this one is not displayed on screen....
		// put this track
		track_arg	= {	content_url	: 'http://localhost:4550/flv/*httpo_maxrate*100k/http://blip.tv/file/get/Demnow-DemocracyNowMondayJuly232007335.flv',
					start_time	: 50,
					rangereq_type 	: 'flv',
					rangereq_flv_var: 'pos'
					};
		player.track_add(track_arg, player.track_count());
}
if(0){
		// put this track
		track_arg	= {	content_url	: "http://localhost:4560/superstream.flv"
					};
		player.track_add(track_arg, player.track_count());
}
if(0){
		// put this track
		track_arg	= {	content_url	: "http://server185a.files.youporn.com/video/04/87/flv/48763_German_Couple_7.flv"
					};
		player.track_add(track_arg, player.track_count());
		// put this track
		track_arg	= {	content_url	: "http://server187a.files.youporn.com/video/02/16/flv/21639_Carly_Parker_5.flv"
					};
		player.track_add(track_arg, player.track_count());
		// put this track
		track_arg	= {	content_url	: "http://server234.files.youporn.com/video/03/48/flv/34863_Susana.flv"
					};
}
if(0){
		//player.track_add(track_arg, player.track_count());
		// put this track
		track_arg	= {	content_url	: "http://jmehost2/~jerome/ntv002.mp4"
					};
		//player.track_add(track_arg, player.track_count());
		// put this track
		track_arg	= {	content_url	: "http://blip.tv/file/get/BreakaLegTV-BreakALegEpisode2Part1174.flv"
					};
		//player.track_add(track_arg, player.track_count());
}
if(0){
		// put this track
//		track_arg	= {	content_url	: "http://jmehost2/~jerome/output.flv"
//		track_arg	= {	content_url	: "http://jmehost2/~jerome/flash/elephantsdream_420_v4.flv"
		track_arg	= {
				"content_url"	: "http://localhost:4550/flv/*httpo_full_id*slota/*httpo_maxrate*250k/http://jmehost2/~jerome/flash/elephantsdream_420_v4.flv",
				"net_ratelim"	: {	"key"	: "slota",
							"uri"	: "http://localhost:4550"
						}
							
					};
		player.track_add(track_arg, player.track_count());
}
		//player.set_sound_vol(0);
	}
	function playlist_dump(){
		var player	= thisMovie("plugin_html_id");
		var track_count	= player.track_count();
		for(var i=0; i < track_count; i++){
			var	track_arg;
			track_arg	= player.track_get(i);
			console.info("Item " + i + ":");
			console.dir(track_arg);
		}
	}
	/** \brief return true if the player is loaded in the browser, false otherwise
	 * 
	 * - some browser (e.g. firefox 3.0) requires some time to initialize 
	 *   the flash so it need to be probed. this function allow to test
	 */
	function is_player_loaded() {
		var player	= thisMovie("plugin_html_id");
		if( player == undefined )			return false;
		if( typeof(player.track_count) != "function" )	return false;
		return true;
	}
</script>


<!--
<input type=button value="change_caption"	onClick='test_change_caption()'>
<input type=button value="dump_info"		onClick='dump_info()'>
<input type=button value="playing_start"	onClick='playing_start()'>
<input type=button value="playing_stop"		onClick='playing_stop()'>
<input type=button value="playlist_dump"	onClick='playlist_dump()'>
<input type=button value="playlist_populate"	onClick='playlist_populate()'>
<br>
-->

<script>
	function build_flash() {
		var allowfullscreen	= true;
		console.info("start building flash");
		var	so	= new SWFObject("flash_player.swf", 'plugin_html_id'
					, "100%", "100%", "9", "#000000", true);
		// put the parameter to the flash plugin itself
		so.addParam("allowScriptAccess"	, "always");
		so.addParam("scale"		, "noscale");
		so.addParam("allowfullscreen"	, allowfullscreen ? "true" : "false");
		// mirror addParam "allowfullscreen" because unable to get addParam from as
		so.addVariable("allowfullscreen", allowfullscreen ? "true" : "false");  
		// put the variable for the flash program
		so.addVariable("jscallback_str"	, "neoip_flash_player_cb");
		so.addVariable("jscallback_key"	, "slota_jscallbackkey");
		// write the result in the html
	      	so.write('neoip_player_container_id');
	      	console.info("flash built");
	}
	function onload_cb() {
		build_flash();
		player_init();
	}
	function player_init(){
		if( !is_player_loaded() ){
			console.info("flash player not loaded retry later");
			// TODO make this timer an exponantial backoff
			setTimeout('player_init()', 100); 
			return;
		}
		console.info("start handling with player");
		playlist_populate();
		playing_start();
		
		return;
		
		var plugin	= thisMovie("plugin_html_id");
		//plugin.set_smoothing(true);

		var embedui_opt	= {	"embedui_class"	: "select_dock",
					"embedui_id"	: "embedui_id_select_dock",
					"userptr": {
						"embedui_id"	: "embedui_id_select_dock",
						},
					"element_opt"	: {
						}
					};
		plugin.embedui_create(embedui_opt);
		return;

		var embedui_opt	= {	"embedui_class"	: "button_volume",
					"embedui_id"	: "button_vol_id",
					"userptr": {
						"embedui_id"	: "button_vol_id",
						},
					"element_opt" : {
						"sound_vol"	: plugin.get_sound_vol(),
						"sound_mute"	: plugin.get_sound_mute()
						},	
				 	"base_sprite" : {
				 		"element_x"	: 0.0,
				 		"element_y"	: 0.0,
				 		"element_w"	: 0.1,
				 		"element_h"	: 0.0,
						"anchor_x"	: 0.5, 
						"anchor_y"	: 0.5,
						"display_type"	: "mouse_over" 
						},
					};
	
		plugin.embedui_create(embedui_opt);

		var embedui_opt	= {	"embedui_class"	: "select_dock",
					"embedui_id"	: "embedui_id_select_dock",
					"userptr": {
						"embedui_id"	: "embedui_id_select_dock",
						},
					"element_opt"	: {
						}
					};
		plugin.embedui_create(embedui_opt);

		
		var embedui_opt	= {	"embedui_class"	: "root_stage",
					"embedui_id"	: "embedui_id_root_stage",
					"userptr": {
						"embedui_id"	: "embedui_id_root_stage",
						},
					"element_opt"	: {
						}
					};
		plugin.embedui_create(embedui_opt);

		var embedui_opt	= {	"embedui_class"	: "select_list",
					"embedui_id"	: "embedui_id_selectlist",
					"userptr": {
						"embedui_id"	: "embedui_id_selectlist",
						},
					"element_opt"	: {
						"selected_idx"	: 0,
						"item_w"	: 400	/1024,
						"item_h"	: 70	/ 768,
						"box_t"		: 7	/1024,
						"margin_w"	: 10	/1024,
						"margin_h"	: 0	/ 768,
						"font_size"	: 60	/1024,
						"item_arr"	: [
							{ "display_text": "sample static"},
							{ "display_text": "super stream"},
							{ "display_text": "YouTube"},
							{ "display_text": "BlipTV"}
							]
						}
					};
		plugin.embedui_create(embedui_opt);

		var embedui_opt	= {	"embedui_class"	: "button_busy",
					"embedui_id"	: "embedui_id_busy",
					"userptr": {
						"embedui_id"	: "embedui_id_busy",
						},
					"element_opt" : {
						"refresh_delay"	: 0.1 * 1000
						},
				 	"base_sprite" : {
				 		"element_x"	: 0.5,
				 		"element_y"	: 0.5,
				 		"element_w"	: 0.1,
				 		"element_h"	: 0.0,
						"anchor_x"	: 0.5, 
						"anchor_y"	: 0.5,
						"display_type"	: "always"
						},
					};
		plugin.embedui_create(embedui_opt);
		
		var embedui_opt	= {	"embedui_class"	: "text_caption",
					"embedui_id"	: "embedui_id_track_title",
					"userptr": {
						"embedui_id"	: "embedui_id_track_title",
						},
					"element_opt" : {
//						"text"		: "golfers for playstation and other very great thing in a long line",
						"text"		: "golfers for playstation",
						"font_size"	: 200/1024
						},
				 	"base_sprite" : {
				 		"element_x"	: 0.5,
				 		"element_y"	: 0.8,
				 		"element_w"	: 1.0,
				 		"element_h"	: 0.0,
						"anchor_x"	: 0.5, 
						"anchor_y"	: 0.5,
						"display_type"	: "always",
						},
					};
		plugin.embedui_create(embedui_opt);
		

//					"bitmap":{
//						"type"		: "dynamic",
//						"location"	: "http://localhost/~jerome/neoip_flash_player/myPhoto.png"
//						},
//					"bitmap" : {
//						"type"		: "embedded",
//						"location"	: "embed_pic_myphoto"
//						},

		var embedui_opt	= {	"embedui_class"	: "button_bitmap",
					"embedui_id"	: "button_winsizer",
					"userptr": {
						"embedui_id"	: "button_winsizer",
						},
					"element_opt" : {
						"type"		: "vector",
						"location"	: plugin.get_fullscreen() 
									? "win_normilizer"
									: "win_maximizer"
						},
				 	"base_sprite" : {
				 		"element_x"	: 1.0,
				 		"element_y"	: 0.0,
				 		"element_w"	: 0.08,
				 		"element_h"	: 0.0,
						"anchor_x"	: 0.0, 
						"anchor_y"	: 0.0,
						"display_type"	: "mouse_over"
						},
					};
		plugin.embedui_create(embedui_opt);

		var embedui_opt	= {	"embedui_class"	: "button_volume",
					"embedui_id"	: "button_vol_id",
					"userptr": {
						"embedui_id"	: "button_vol_id",
						},
					"element_opt" : {
						"sound_vol"	: plugin.get_sound_vol(),
						"sound_mute"	: plugin.get_sound_mute()
						},	
				 	"base_sprite" : {
				 		"element_x"	: 0.0,
				 		"element_y"	: 0.0,
				 		"element_w"	: 0.1,
				 		"element_h"	: 0.0,
						"anchor_x"	: 0.5, 
						"anchor_y"	: 0.5,
						"display_type"	: "mouse_over" 
						},
					};
	
		plugin.embedui_create(embedui_opt);

// TODO find how to get proper scaling of textf
 

		var embedui_opt	= {	"embedui_class"	: "button_bitmap",
					"embedui_id"	: "button_play",
					"userptr": {
						"embedui_id"	: "button_play",
						},
					"element_opt" : {
						"type"		: "vector",
						"location"	: "stop"
						},
				 	"base_sprite" : {
				 		"element_x"	: 0.5,
				 		"element_y"	: 0.5,
				 		"element_w"	: 0.1,
				 		"element_h"	: 0.0,
						"anchor_x"	: 0.5, 
						"anchor_y"	: 0.5,
						"display_type"	: "always"
						},
					};
		plugin.embedui_create(embedui_opt);
		// lame test for flv_kframe_find
		//var player	= thisMovie("plugin_html_id");
		//player.flv_kframe_find(0, "internal", "http://jmehost2/~jerome/output.flv", "boubou"); 
	}
	function test_change_caption(){
		var plugin	= thisMovie("plugin_html_id");
		var embedui_id	= "embedui_id_track_title";
		// make the embedui invisible
		plugin.embedui_update(embedui_id, { "action": "base_reset_state",
						"arg":	{ "new_state": "invisible" } });
		// change the text
		plugin.embedui_update(embedui_id, { "action": "element_update_opt",
						"arg":	{ "text": "Super new text" } });
		// make the embedui appearing
		plugin.embedui_update(embedui_id, { "action": "base_reset_state",
						"arg":	{ "new_state": "appearing" } });
	}
	
	
</script>
</body>
</html>